<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/czhu12/react-importer@master/dist/react-importer.css"></style>
    <script type="importmap">
      {
        "imports": {
          "preact": "https://esm.sh/preact@10.23.1",
          "htm/preact": "https://esm.sh/htm@3.1.1/preact?external=preact",
          "react-importer": "https://cdn.jsdelivr.net/gh/czhu12/react-importer@v0.1.4/dist/index.es.js"
        }
      }
    </script>
  </head>
  <body>
    <div id="app"></div>

    <script type="module">

      import { render } from 'preact';
      import { html } from 'htm/preact';
      import Importer from 'react-importer';
      const onComplete = async (data, onProgress) => {
        await new Promise((resolve) => setTimeout(resolve, 200));
        onProgress(20);
        await new Promise((resolve) => setTimeout(resolve, 200));
        onProgress(50);
        await new Promise((resolve) => setTimeout(resolve, 200));
        onProgress(100);
        console.log(data);
        setReady(true);
      }


      render(html`
      <${Importer}
        sheets=${[
          {
            id: 'employees',
            label: 'Employees',
            columns: [
              {
                label: 'Employee ID',
                id: 'employee_id',
                type: 'number',
                validators: [
                  { validate: 'required' },
                  {
                    validate: 'unique',
                    error: 'This employee ID is not unique',
                  },
                  {
                    validate: 'is_integer',
                    error: 'This value must be a number',
                  },
                ],
              },
              {
                label: 'Email',
                id: 'email',
                type: 'string',
                validators: [
                  { validate: 'required' },
                  { validate: 'unique', error: 'This email is not unique' },
                  {
                    validate: 'regex_matches',
                    regex:
                      /^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,
                    error: 'This email is not valid',
                  },
                ],
              },
              {
                label: 'Phone Number',
                id: 'phone_number',
                type: 'string',
                validators: [{ validate: 'required' }],
              },
              {
                label: 'Address',
                id: 'address',
                type: 'string',
                validators: [{ validate: 'required' }],
              },
              { label: 'City', id: 'city', type: 'string' },
              {
                label: 'State',
                id: 'state',
                type: 'string',
                transformers: [{ transformer: 'state_code' }],
              },
              {
                label: 'Zip Code',
                id: 'zip_code',
                type: 'string',
                validators: [{ validate: 'required' }],
              },
            ],
          },
        ]}
        onDataColumnsMapped=${(dataColumns) => {
          console.log(dataColumns);
          return dataColumns;
        }}
        onComplete=${onComplete}
        preventUploadOnValidationErrors
      />
`, document.getElementById('app'));
    </script>
  </body>
</html>